input {
      http_poller {
                   urls => {
                       XMA => {
                             method => get
                             user => "${JIRA_USER}"
                             password => "${JIRA_PWD}"
                             url => "https://epm.verisk.com/jira/rest/api/2/search?jql=project=XMA&expand=changelog"
                             headers => {
                                     Accept => "application/json"
                             }
                        }
                   }
                   schedule => { every => "60s"}
                   codec => "json"
      }

}

filter {
 split {
  field => "[issues]"
 }
 
 split {
  field => "[issues][changelog][histories]"
 }

 
 split {
  field => "[issues][changelog][histories][items]"
}

 mutate {
  rename => {
   "key" => "[issues][key]"
   "created" => "[issues][changelog][histories][created]"
   "author" => "issues][changelog][histories][author]"
   "field" => "[issues][changelog][histories][items][field]"
		 "fieldtype" => "[issues][changelog][histories][items][fieldtype]"
		 "from" => "[issues][changelog][histories][items][from]"
		 "fromString" => "[issues][changelog][histories][items][fromString]"
 		 "to" => "[issues][changelog][histories][items][to]"
 		 "toString" => "[issues][changelog][histories][items][toString]"
	
  }

 }
}

output {
  elasticsearch {
                hosts => ["elasticsearch:9200"]
                index => "jira-changes"
  }
}