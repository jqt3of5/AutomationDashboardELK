input {
 pipeline { address => jira_changes }
}

filter {

 ruby {
    path => "/usr/share/logstash/pipeline/time_in_status.rb"
 }

 mutate {
  rename => {
   "[issues][key]" => "key"
   "[issues][changelog][histories][id]" => "change_id"
   "[issues][changelog][histories][author]" => "author"
   "[issues][changelog][histories][created]" => "created"
   "[issues][changelog][histories][nextTransition]" => "nextTransition"
   "[issues][changelog][histories][items][from]" => "from"
   "[issues][changelog][histories][items][fromString]" => "fromString"
   "[issues][changelog][histories][items][to]" => "to"
   "[issues][changelog][histories][items][toString]" => "toString"
   "[issues][changelog][histories][items][field]" => "field"
   "[issues][changelog][histories][items][fieldtype]" => "fieldtype"
  }
  remove_field => [ "[issues]" ]
 }
}

output {
    file { path => "/usr/share/logstash/config/jira_changelog.json" }
    elasticsearch{
        index => "jira_changelog"
        hosts => ["elasticsearch"]
        document_id => "%{[key]}_%{[change_id]}_%{[field]}"
        action => "create"
    }
}
